<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>志工排班查詢系統 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        // 注意：這裡直接從 lucide-react 引入所有圖示可能會導致瀏覽器加載較慢
        // 但為了相容原本程式碼，我們維持原樣
        import { Search, Calendar, User, Download, FileText, FileSpreadsheet, RefreshCw, Settings, Info, Lock, Database, ExternalLink, AlertCircle, Cloud, Filter, CheckCircle, XCircle, ArrowRight, ChevronLeft, ChevronRight, Grid, List, X, Sparkles, MessageSquare, Loader, Copy, Bot } from 'lucide-react';

        // ==========================================
        // ↓↓↓ 請將你原本的完整程式碼貼在下方 ↓↓↓
        // ==========================================

        const APP_VERSION = "App v2.7.0 (Fix Alerts)"; 
const DEFAULT_DATA_VERSION = "Data 2026.01.15 (Dojo Update)";

// 雲端更新管理表 (Google Sheet)
const UPDATE_MANAGER_SHEET_ID = "17Ywmsgu8FAVPI1Wd7IDs1QkTy2J9j5M4ROzjXul54bM";
const UPDATE_MANAGER_URL = `https://docs.google.com/spreadsheets/d/${UPDATE_MANAGER_SHEET_ID}/export?format=csv`;

// 預設的 fallback 連結
const DEFAULT_SOURCE_URL = "https://notebooklm.google.com/"; 

// Gemini API Key
const apiKey = ""; 

// --- 輔助函式 ---

const fetchWithProxy = async (url) => {
  try {
    const response = await fetch(url);
    if (response.ok) return response;
    throw new Error("Direct fetch failed");
  } catch (e) {
    console.log("Direct fetch failed, trying proxy...");
    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
    return await fetch(proxyUrl);
  }
};

const normalizeDate = (dateStr) => {
  if (!dateStr) return "";
  if (dateStr.match(/^\d{4}\/\d{1,2}\/\d{1,2}/)) {
    const cleanDate = dateStr.split(' ')[0];
    const parts = cleanDate.split('/');
    return `${parts[0]}/${parts[1].padStart(2, '0')}/${parts[2].padStart(2, '0')}`;
  }
  const match = dateStr.match(/(\d{1,2})\/(\d{1,2})/);
  if (match) {
    return `2026/${match[1].padStart(2, '0')}/${match[2].padStart(2, '0')}`;
  }
  return dateStr;
};

const ensureYearInString = (dateStr) => {
  if (!dateStr) return "";
  const str = String(dateStr).trim();
  if (!str.match(/^\d{4}/)) {
    return `2026/${str}`;
  }
  return str;
};

const getGoogleSheetXlsxUrl = (url) => {
  const regex = /docs\.google\.com\/spreadsheets\/d\/([a-zA-Z0-9-_]+)(?:\/.*)?/;
  const match = url.match(regex);
  if (match && match[1]) {
    return `https://docs.google.com/spreadsheets/d/${match[1]}/export?format=xlsx`;
  }
  return null;
};

// 呼叫 Gemini API
const callGeminiAPI = async (prompt) => {
  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
  const payload = {
    contents: [{ parts: [{ text: prompt }] }]
  };

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
        throw new Error(`Gemini API Error: ${response.status}`);
    }

    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || "無法取得回應";
  } catch (error) {
    console.error("Gemini API Call Failed", error);
    return "AI 服務暫時無法使用，請稍後再試。";
  }
};

// 智慧型文字解析
const parseRawTextData = (text) => {
  const lines = text.split('\n');
  const parsed = [];
  let currentType = '未分類';
  const datePattern = /(\d{4}\/)?\d{1,2}\/\d{1,2}/;
  
  lines.forEach(line => {
    const trimmed = line.trim();
    if (!trimmed) return;

    if (trimmed.includes('大愛')) currentType = '大愛';
    else if (trimmed.includes('大佛手')) currentType = '大佛手';
    else if (trimmed.includes('護衛隊')) currentType = '護衛隊';
    else if (trimmed.includes('道場功法')) currentType = '道場功法';
    else if (trimmed.includes('大正功法')) currentType = '大正功法';
    else if (trimmed.includes('讀書會')) currentType = '讀書會';
    else if (trimmed.includes('攝影')) currentType = '攝影座談';

    if (trimmed.includes('|')) {
       if (trimmed.match(/\|[\s-]+\|/)) return;
       const cols = trimmed.split('|').map(c => c.trim()).filter(c => c);
       const dateColIndex = cols.findIndex(c => datePattern.test(c));
       
       if (dateColIndex !== -1) {
          let rawDate = cols[dateColIndex];
          rawDate = ensureYearInString(rawDate);
          let names = [];
          let role = '志工';
          let content = '';

          cols.forEach((col, idx) => {
             if (idx === dateColIndex) return;
             if (col.match(/活動|日期|志工|姓名|職務|教練|助教|領讀人|內容|備註/)) return;
             if (col.length < 2) return;
             if (col.match(/^\d+$/)) return;

             if (currentType === '道場功法') {
                if (col.includes('養生') || col.includes('12瓣') || col.includes('功法') || col.includes('研習')) {
                   content = col;
                } else {
                   if (col.includes('教練') || col.includes('助教')) {
                      names.push(col);
                      role = '教練/助教';
                   } else {
                      names.push(col); 
                   }
                }
             } else if (currentType === '大正功法') {
                if (col.includes('功法') || col.includes('蓮花') || col.includes('教學') || col.includes('利筋')) {
                    const match = col.match(/(.*?)\((.*?)\)/);
                    if (match) {
                        names.push(match[1]);
                        content += match[2] + " ";
                    } else {
                        content += col + " ";
                    }
                } else {
                    names.push(col);
                }
                role = '志工/學員';
             } else if (currentType === '大愛' && (col.includes('法會') || col.includes('捐血') || col.includes('講座') || col.includes('禮佛'))) {
                content = col;
             } else if (currentType === '大佛手' && (col.includes('法會') || col.includes('捐血') || col.includes('講座') || col.includes('禮佛'))) {
                content = col;
             } else {
                 names.push(col);
             }
          });

          if (names.length > 0) {
             parsed.push({
               date: rawDate,
               type: currentType,
               names: names,
               role: role,
               content: content.trim()
             });
          }
       }
    }
  });
  return parsed;
};

// 原始預設資料
const INITIAL_RAW_DATA = [
  // --- 大愛 ---
 { date: "2026/1/1 (四)", type: "大愛", "names": ["彌勒澄明"], role: "志工", content: "115年元旦" },
  { date: "2026/1/3 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/1/4 (日)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "捐血 禮佛日" },
  { date: "2026/1/10 (六)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/1/11 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "嚴聖尊佛成道日法會 農曆11月23日" },
  { date: "2026/1/17 (六)", type: "大愛", "names": ["彌勒信永"], role: "志工", content: "" },
  { date: "2026/1/18 (日)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/1/24 (六)", type: "大愛", "names": ["彌德元"], role: "志工", content: "" },
  { date: "2026/1/25 (日)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "嚴仁尊佛成道日法會 農曆12月7日" },
  { date: "2026/1/31 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/2/1 (日)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "捐血、彌勒一貫道講座＋慶生會 禮佛日" },
  { date: "2026/2/7 (六)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "台北國際書展" },
  { date: "2026/2/8 (日)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "台北國際書展" },
  { date: "2026/2/14 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/2/15 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "" },
  { date: "2026/2/17 (二)", type: "大愛", "names": ["彌勒明圓"], role: "志工", content: "農曆正月初一 彌勒尊佛佛誕日法會" },
  { date: "2026/2/18 (三)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "農曆正月初二 春節連假" },
  { date: "2026/2/19 (四)", type: "大愛", "names": ["彌德元"], role: "志工", content: "農曆正月初三 春節連假" },
  { date: "2026/2/20 (五)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "農曆正月初四 列假日補假 (小年夜)" },
  { date: "2026/2/21 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "農曆正月初五" },
  { date: "2026/2/22 (日)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "農曆正月初六" },
  { date: "2026/2/27 (五)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "列假日補假 (和平紀念日)" },
  { date: "2026/2/28 (六)", type: "大愛", "names": ["彌勒澄明"], role: "志工", content: "" },
  { date: "2026/3/1 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "捐血 禮佛日" },
  { date: "2026/3/7 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "皇母聖道日法會" },
  { date: "2026/3/8 (日)", type: "大愛", "names": ["彌勒明圓"], role: "志工", content: "皇母聖道日法會 農曆1月20日" },
  { date: "2026/3/14 (六)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "" },
  { date: "2026/3/15 (日)", type: "大愛", "names": ["彌德元"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/3/21 (六)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "" },
  { date: "2026/3/22 (日)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/3/28 (六)", type: "大愛", "names": ["彌勒信永"], role: "志工", content: "皇母聖誕日法會" },
  { date: "2026/3/29 (日)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "皇母聖誕日法會 農曆2月11日" },
  { date: "2026/4/3 (五)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "兒童節" },
  { date: "2026/4/4 (六)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "" },
  { date: "2026/4/5 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "捐血 清明節  禮佛日" },
  { date: "2026/4/11 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/4/12 (日)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "清明祈福法會 農曆2月25日" },
  { date: "2026/4/18 (六)", type: "大愛", "names": ["彌德元"], role: "志工", content: "" },
  { date: "2026/4/19 (日)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/4/25 (六)", type: "大愛", "names": ["彌勒正識"], role: "志工", content: "" },
  { date: "2026/4/26 (日)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "盤古尊佛成道日法會 農曆3月10日" },
  { date: "2026/5/1 (五)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "勞動節" },
  { date: "2026/5/2 (六)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/5/3 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "禮佛日" },
  { date: "2026/5/9 (六)", type: "大愛", "names": ["彌德元"], role: "志工", content: "媽祖天后聖誕日法會" },
  { date: "2026/5/10 (日)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "捐血" },
  { date: "2026/5/16 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/5/17 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/5/23 (六)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "" },
  { date: "2026/5/24 (日)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/5/30 (六)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "" },
  { date: "2026/5/31 (日)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "" },
  { date: "2026/6/6 (六)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/6/7 (日)", type: "大愛", "names": ["彌勒旻賢"], role: "志工", content: "禮佛日" },
  { date: "2026/6/13 (六)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "" },
  { date: "2026/6/14 (日)", type: "大愛", "names": ["彌勒澄明"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/6/19 (五)", type: "大愛", "names": ["彌德元"], role: "志工", content: "端午節" },
  { date: "2026/6/20 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/6/21 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "捐血" },
  { date: "2026/6/27 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/6/28 (日)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "嚴慈尊佛成道日法會 農曆5月14日" },
  { date: "2026/7/4 (六)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "" },
  { date: "2026/7/5 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "捐血 禮佛日" },
  { date: "2026/7/11 (六)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "" },
  { date: "2026/7/12 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "" },
  { date: "2026/7/18 (六)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "" },
  { date: "2026/7/19 (日)", type: "大愛", "names": ["彌德元"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/7/25 (六)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "" },
  { date: "2026/7/26 (日)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/8/1 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "皇母出家法會" },
  { date: "2026/8/2 (日)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "皇母出家法會  禮佛日 農曆6月20日" },
  { date: "2026/8/8 (六)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "" },
  { date: "2026/8/9 (日)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "捐血" },
  { date: "2026/8/15 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/8/16 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/8/22 (六)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "台北佛展(8/21 - 8/24)" },
  { date: "2026/8/23 (日)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "台北佛展(8/21 - 8/24)" },
  { date: "2026/8/29 (六)", type: "大愛", "names": ["彌德元"], role: "志工", content: "" },
  { date: "2026/8/30 (日)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "中元普渡祈福法會 農曆7月18日" },
  { date: "2026/9/5 (六)", type: "大愛", "names": ["彌勒信永"], role: "志工", content: "" },
  { date: "2026/9/6 (日)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "禮佛日" },
  { date: "2026/9/12 (六)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "" },
  { date: "2026/9/13 (日)", type: "大愛", "names": ["彌勒旻賢"], role: "志工", content: "" },
  { date: "2026/9/19 (六)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/9/20 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "" },
  { date: "2026/9/25 (五)", type: "大愛", "names": ["彌德元"], role: "志工", content: "中秋節" },
  { date: "2026/9/26 (六)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "" },
  { date: "2026/9/27 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "彌勒一貫道講座＋慶生會+捐血" },
  { date: "2026/9/28 (一)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "教師節" },
  { date: "2026/10/3 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/10/4 (日)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "禮佛日" },
  { date: "2026/10/9 (五)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "列假日補假 (國慶日)" },
  { date: "2026/10/10 (六)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "" },
  { date: "2026/10/11 (日)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/10/17 (六)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "媽祖天后成道日法會" },
  { date: "2026/10/18 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "捐血" },
  { date: "2026/10/24 (六)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "" },
  { date: "2026/10/25 (日)", type: "大愛", "names": ["彌德元"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/10/26 (一)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "列假日補假 (光復節)" },
  { date: "2026/10/31 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "皇母成道日法會" },
  { date: "2026/11/1 (日)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "皇母成道日法會 禮佛日 農曆9月23日" },
  { date: "2026/11/7 (六)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "" },
  { date: "2026/11/8 (日)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "" },
  { date: "2026/11/14 (六)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "" },
  { date: "2026/11/15 (日)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/11/21 (六)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/11/22 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "捐血" },
  { date: "2026/11/28 (六)", type: "大愛", "names": ["彌德元"], role: "志工", content: "" },
  { date: "2026/11/29 (日)", type: "大愛", "names": ["彌勒行慈"], role: "志工", content: "" },
  { date: "2026/12/5 (六)", type: "大愛", "names": ["彌勒知行"], role: "志工", content: "" },
  { date: "2026/12/6 (日)", type: "大愛", "names": ["彌勒敬合"], role: "志工", content: "禮佛日" },
  { date: "2026/12/12 (六)", type: "大愛", "names": ["彌勒聞元"], role: "志工", content: "" },
  { date: "2026/12/13 (日)", type: "大愛", "names": ["彌勒仁行"], role: "志工", content: "捐血、彌勒一貫道講座＋慶生會" },
  { date: "2026/12/19 (六)", type: "大愛", "names": ["彌勒尼恒"], role: "志工", content: "" },
  { date: "2026/12/20 (日)", type: "大愛", "names": ["彌勒靜羽"], role: "志工", content: "" },
  { date: "2026/12/25 (五)", type: "大愛", "names": ["彌勒決立"], role: "志工", content: "列假日補假 (行憲紀念日)" },
  { date: "2026/12/26 (六)", type: "大愛", "names": ["彌勒易決"], role: "志工", content: "" },
  { date: "2026/12/27 (日)", type: "大愛", "names": ["彌德元"], role: "志工", content: "嚴聖尊佛成道日法會 農曆11月19日" },

  // --- 大佛手 ---
   { date: "2026/1/1 (四)", type: "大佛手", names: ["彌勒故明", "彌勒敬合", "彌勒塵耀"], role: "志工", content: "115年元旦" },
  { date: "2026/1/3 (六)", type: "大佛手", names: ["彌勒仁辰", "彌勒耀潔", "彌勒明利"], role: "志工", content: "" },
  { date: "2026/1/4 (日)", type: "大佛手", names: ["彌勒潔仁", "彌勒佑正", "彌勒意能"], role: "志工", content: "捐血 禮佛日" },
  { date: "2026/1/10 (六)", type: "大佛手", names: ["彌勒潔聞", "彌勒淨慧", "彌勒識正"], role: "志工", content: "" },
  { date: "2026/1/11 (日)", type: "大佛手", names: ["彌勒恆願", "彌勒立嘉", "彌勒敏躍"], role: "志工", content: "嚴聖尊佛成道日法會 農曆11月23日" },
  { date: "2026/1/17 (六)", type: "大佛手", names: ["彌勒淨元", "彌勒擇智", "彌勒賢意"], role: "志工", content: "" },
  { date: "2026/1/18 (日)", type: "大佛手", names: ["彌勒靜延", "彌勒勝棋", "彌勒覺志"], role: "志工", content: "講座+慶生會" },
  { date: "2026/1/24 (六)", type: "大佛手", names: ["彌勒語立", "彌勒延群", "彌勒敬正"], role: "志工", content: "" },
  { date: "2026/1/25 (日)", type: "大佛手", names: ["彌勒世振", "彌勒馥真", "廖詠媗"], role: "志工", content: "嚴仁尊佛成道日法會 農曆12月7日" },
  { date: "2026/1/31 (六)", type: "大佛手", names: ["馬諭姍", "彌勒樂禪", "彌勒深益"], role: "志工", content: "" },
  { date: "2026/2/1 (日)", type: "大佛手", names: ["彌勒順塵", "彌勒毅仁", "彌勒義誠"], role: "志工", content: "捐血、彌勒一貫道講座＋慶生會 禮佛日" },
  { date: "2026/2/7 (六)", type: "大佛手", names: ["彌勒覺行", "彌勒澄明", "彌勒慧訣"], role: "志工", content: "台北國際書展" },
  { date: "2026/2/8 (日)", type: "大佛手", names: ["彌勒仁誠", "彌勒旻賢", "彌勒潔聞"], role: "志工", content: "台北國際書展" },
  { date: "2026/2/14 (六)", type: "大佛手", names: ["彌勒延真", "彌勒羽塵", "彌勒成智"], role: "志工", content: "" },
  { date: "2026/2/15 (日)", type: "大佛手", names: ["彌勒勝棋", "李筠婓", "彌勒元照"], role: "志工", content: "" },
  { date: "2026/2/17 (二)", type: "大佛手", names: ["彌勒圓識", "彌勒故明", "彌勒潔仁"], role: "志工", content: "農曆正月初一 彌勒尊佛佛誕日法會" },
  { date: "2026/2/18 (三)", type: "大佛手", names: ["彌勒塵耀", "彌勒仁辰", "彌勒賢意"], role: "志工", content: "農曆正月初二 春節連假" },
  { date: "2026/2/19 (四)", type: "大佛手", names: ["彌勒啓昇", "彌勒塵寧", "彌勒佑正"], role: "志工", content: "農曆正月初三 春節連假" },
  { date: "2026/2/20 (五)", type: "大佛手", names: ["彌勒意能", "彌勒靜延", "彌勒淨慧"], role: "志工", content: "農曆正月初四 列假日補假 (小年夜)" },
  { date: "2026/2/21 (六)", type: "大佛手", names: ["彌勒擇智", "彌勒覺志", "彌勒立嘉"], role: "志工", content: "農曆正月初五" },
  { date: "2026/2/22 (日)", type: "大佛手", names: ["彌勒識正", "彌勒語立", "彌勒敏躍"], role: "志工", content: "農曆正月初六" },
  { date: "2026/2/27 (五)", type: "大佛手", names: ["彌勒恆願", "彌勒淨元", "彌勒覺行"], role: "志工", content: "列假日補假 (和平紀念日)" },
  { date: "2026/2/28 (六)", type: "大佛手", names: ["彌勒易決", "彌勒敬合", "彌勒延群"], role: "志工", content: "" },
  { date: "2026/3/1 (日)", type: "大佛手", names: ["彌勒敬正", "彌勒世振", "彌勒明利"], role: "志工", content: "捐血 禮佛日" },
  { date: "2026/3/7 (六)", type: "大佛手", names: ["彌勒成智", "馬諭姍", "彌勒樂禪"], role: "志工", content: "皇母聖道日法會" },
  { date: "2026/3/8 (日)", type: "大佛手", names: ["彌勒深益", "彌勒潔仁", "彌勒意能"], role: "志工", content: "皇母聖道日法會 農曆1月20日" },
  { date: "2026/3/14 (六)", type: "大佛手", names: ["彌勒仁誠", "彌勒圓識", "彌勒潔聞"], role: "志工", content: "" },
  { date: "2026/3/15 (日)", type: "大佛手", names: ["彌勒勝棋", "彌勒延真", "彌勒羽塵"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/3/21 (六)", type: "大佛手", names: ["彌勒順塵", "彌勒義誠", "彌勒毅仁"], role: "志工", content: "" },
  { date: "2026/3/22 (日)", type: "大佛手", names: ["彌勒旻賢", "彌勒元照", "李筠婓"], role: "志工", content: "" },
  { date: "2026/3/28 (六)", type: "大佛手", names: ["廖詠媗", "彌勒耀潔", "彌勒故明"], role: "志工", content: "皇母聖誕日法會" },
  { date: "2026/3/29 (日)", type: "大佛手", names: ["彌勒慧明", "彌勒塵耀", "彌勒仁辰"], role: "志工", content: "皇母聖誕日法會 農曆2月11日" },
  { date: "2026/4/3 (五)", type: "大佛手", names: ["彌勒淨慧", "彌勒馥真", "彌勒塵寧"], role: "志工", content: "兒童節" },
  { date: "2026/4/4 (六)", type: "大佛手", names: ["彌勒佑正", "彌勒意能", "彌勒延群"], role: "志工", content: "" },
  { date: "2026/4/5 (日)", type: "大佛手", names: ["彌勒靜羽", "彌勒識正", "彌勒覺志"], role: "志工", content: "捐血 清明節  禮佛日" },
  { date: "2026/4/11 (六)", type: "大佛手", names: ["彌勒成智", "彌勒擇智", "彌勒慧明"], role: "志工", content: "" },
  { date: "2026/4/12 (日)", type: "大佛手", names: ["彌勒敏躍", "彌勒恆願", "彌勒淨元"], role: "志工", content: "清明祈福法會 農曆2月25日" },
  { date: "2026/4/18 (六)", type: "大佛手", names: ["彌勒覺行", "彌勒靜延", "彌勒耀潔"], role: "志工", content: "" },
  { date: "2026/4/19 (日)", type: "大佛手", names: ["彌勒澄明", "彌勒賢意", "彌勒世振"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/4/25 (六)", type: "大佛手", names: ["彌勒馥真", "廖詠媗", "馬諭姍"], role: "志工", content: "" },
  { date: "2026/4/26 (日)", type: "大佛手", names: ["彌勒樂禪", "彌勒深益", "彌勒慧訣"], role: "志工", content: "盤古尊佛成道日法會 農曆3月10日" },
  { date: "2026/5/1 (五)", type: "大佛手", names: ["彌勒仁誠", "彌勒圓識", "彌勒啓昇"], role: "志工", content: "勞動節" },
  { date: "2026/5/2 (六)", type: "大佛手", names: ["彌勒順塵", "彌勒義誠", "彌勒毅仁"], role: "志工", content: "" },
  { date: "2026/5/3 (日)", type: "大佛手", names: ["彌勒延真", "彌勒羽塵", "彌勒潔聞"], role: "志工", content: "禮佛日" },
  { date: "2026/5/9 (六)", type: "大佛手", names: ["彌勒慧明", "彌勒元照", "李筠婓"], role: "志工", content: "媽祖天后聖誕日法會" },
  { date: "2026/5/10 (日)", type: "大佛手", names: ["彌勒旻賢", "彌勒潔仁", "彌勒敏躍"], role: "志工", content: "捐血" },
  { date: "2026/5/16 (六)", type: "大佛手", names: ["彌勒故明", "彌勒成智", "彌勒塵耀"], role: "志工", content: "" },
  { date: "2026/5/17 (日)", type: "大佛手", names: ["彌勒仁辰", "彌勒塵寧", "彌勒延真"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/5/23 (六)", type: "大佛手", names: ["彌勒語立", "彌勒佑正", "彌勒意能"], role: "志工", content: "" },
  { date: "2026/5/24 (日)", type: "大佛手", names: ["彌勒慧訣", "彌勒淨慧", "彌勒識正"], role: "志工", content: "" },
  { date: "2026/5/30 (六)", type: "大佛手", names: ["彌勒覺志", "彌勒立嘉", "彌勒澄明"], role: "志工", content: "" },
  { date: "2026/5/31 (日)", type: "大佛手", names: ["彌勒賢意", "彌勒擇智", "彌勒深益"], role: "志工", content: "" },
  { date: "2026/6/6 (六)", type: "大佛手", names: ["彌勒淨元", "彌勒敬正", "彌勒靜延"], role: "志工", content: "" },
  { date: "2026/6/7 (日)", type: "大佛手", names: ["彌勒耀潔", "彌勒延群", "彌勒旻賢"], role: "志工", content: "禮佛日" },
  { date: "2026/6/13 (六)", type: "大佛手", names: ["彌勒世振", "彌勒馥真", "廖詠媗"], role: "志工", content: "" },
  { date: "2026/6/14 (日)", type: "大佛手", names: ["彌勒勝棋", "彌勒樂禪", "彌勒深益"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/6/19 (五)", type: "大佛手", names: ["彌勒啓昇", "彌勒仁誠", "彌勒圓識"], role: "志工", content: "端午節" },
  { date: "2026/6/20 (六)", type: "大佛手", names: ["馬諭姍", "彌勒成智", "彌勒覺行"], role: "志工", content: "" },
  { date: "2026/6/21 (日)", type: "大佛手", names: ["彌勒順塵", "彌勒毅仁", "彌勒義誠"], role: "志工", content: "捐血" },
  { date: "2026/6/27 (六)", type: "大佛手", names: ["彌勒慧明", "彌勒羽塵", "彌勒潔聞"], role: "志工", content: "" },
  { date: "2026/6/28 (日)", type: "大佛手", names: ["彌勒元照", "李筠婓", "彌勒識正"], role: "志工", content: "嚴慈尊佛成道日法會 農曆5月14日" },
  { date: "2026/7/4 (六)", type: "大佛手", names: ["彌勒澄明", "彌勒故明", "彌勒仁辰"], role: "志工", content: "" },
  { date: "2026/7/5 (日)", type: "大佛手", names: ["彌勒塵耀", "彌勒賢意", "彌勒語立"], role: "志工", content: "捐血 禮佛日" },
  { date: "2026/7/11 (六)", type: "大佛手", names: ["彌勒明利", "彌勒塵寧", "彌勒佑正"], role: "志工", content: "" },
  { date: "2026/7/12 (日)", type: "大佛手", names: ["彌勒元照", "李筠婓", "彌勒淨慧"], role: "志工", content: "" },
  { date: "2026/7/18 (六)", type: "大佛手", names: ["彌勒順塵", "彌勒毅仁", "彌勒義誠"], role: "志工", content: "" },
  { date: "2026/7/19 (日)", type: "大佛手", names: ["彌勒敏躍", "彌勒塵寧", "彌勒擇智"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/7/25 (六)", type: "大佛手", names: ["彌勒恆願", "彌勒淨元", "彌勒覺行"], role: "志工", content: "" },
  { date: "2026/7/26 (日)", type: "大佛手", names: ["彌勒靜延", "彌勒耀潔", "彌勒延群"], role: "志工", content: "" },
  { date: "2026/8/1 (六)", type: "大佛手", names: ["彌勒敬正", "彌勒世振", "彌勒馥真"], role: "志工", content: "皇母出家日法會" },
  { date: "2026/8/2 (日)", type: "大佛手", names: ["廖詠媗", "馬諭姍", "彌勒慧明"], role: "志工", content: "皇母出家日法會  禮佛日 農曆6月20日" },
  { date: "2026/8/8 (六)", type: "大佛手", names: ["彌勒淨慧", "彌勒啓昇", "彌勒仁誠"], role: "志工", content: "" },
  { date: "2026/8/9 (日)", type: "大佛手", names: ["彌勒圓識", "彌勒勝棋", "彌勒旻賢"], role: "志工", content: "捐血" },
  { date: "2026/8/15 (六)", type: "大佛手", names: ["彌勒成智", "彌勒潔聞", "彌勒故明"], role: "志工", content: "" },
  { date: "2026/8/16 (日)", type: "大佛手", names: ["彌勒延真", "彌勒羽塵", "彌勒賢意"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/8/22 (六)", type: "大佛手", names: ["彌勒覺志", "彌勒元照", "李筠婓"], role: "志工", content: "台北佛展(8/21 - 8/24)" },
  { date: "2026/8/23 (日)", type: "大佛手", names: ["彌勒順塵", "彌勒毅仁", "彌勒義誠"], role: "志工", content: "台北佛展(8/21 - 8/24)" },
  { date: "2026/8/29 (六)", type: "大佛手", names: ["彌勒潔仁", "彌勒塵耀", "彌勒仁辰"], role: "志工", content: "" },
  { date: "2026/8/30 (日)", type: "大佛手", names: ["彌勒語立", "彌勒明利", "彌勒塵寧"], role: "志工", content: "中元普渡祈福法會 農曆7月18日" },
  { date: "2026/9/5 (六)", type: "大佛手", names: ["彌勒明利", "彌勒羽塵", "彌勒慧明"], role: "志工", content: "" },
  { date: "2026/9/6 (日)", type: "大佛手", names: ["彌勒賢意", "彌勒識正", "彌勒覺志"], role: "志工", content: "禮佛日" },
  { date: "2026/9/12 (六)", type: "大佛手", names: ["彌勒立嘉", "彌勒擇智", "彌勒澄明"], role: "志工", content: "" },
  { date: "2026/9/13 (日)", type: "大佛手", names: ["彌勒敏躍", "彌勒旻賢", "彌勒淨元"], role: "志工", content: "" },
  { date: "2026/9/19 (六)", type: "大佛手", names: ["彌勒覺行", "彌勒靜延", "彌勒耀潔"], role: "志工", content: "" },
  { date: "2026/9/20 (日)", type: "大佛手", names: ["彌勒延群", "彌勒敬正", "彌勒世振"], role: "志工", content: "" },
  { date: "2026/9/25 (五)", type: "大佛手", names: ["彌勒馥真", "廖詠媗", "馬諭姍"], role: "志工", content: "中秋節" },
  { date: "2026/9/26 (六)", type: "大佛手", names: ["彌勒樂禪", "彌勒恆願", "彌勒慧訣"], role: "志工", content: "" },
  { date: "2026/9/27 (日)", type: "大佛手", names: ["彌勒塵耀", "彌勒深益", "彌勒勝棋"], role: "志工", content: "彌勒一貫道講座＋慶生會+捐血" },
  { date: "2026/9/28 (一)", type: "大佛手", names: ["彌勒佑正", "彌勒圓識", "彌勒潔仁"], role: "志工", content: "教師節" },
  { date: "2026/10/3 (六)", type: "大佛手", names: ["彌勒順塵", "彌勒義誠", "彌勒毅仁"], role: "志工", content: "" },
  { date: "2026/10/4 (日)", type: "大佛手", names: ["彌勒靜羽", "彌勒羽塵", "彌勒成智"], role: "志工", content: "禮佛日" },
  { date: "2026/10/9 (五)", type: "大佛手", names: ["彌勒仁誠", "彌勒潔聞", "彌勒澄明"], role: "志工", content: "列假日補假 (國慶日)" },
  { date: "2026/10/10 (六)", type: "大佛手", names: ["彌勒故明", "李筠婓", "彌勒元照"], role: "志工", content: "" },
  { date: "2026/10/11 (日)", type: "大佛手", names: ["彌勒仁辰", "彌勒語立", "彌勒明利"], role: "志工", content: "" },
  { date: "2026/10/17 (六)", type: "大佛手", names: ["彌勒塵寧", "彌勒佑正", "彌勒意能"], role: "志工", content: "媽祖天后成道日法會" },
  { date: "2026/10/18 (日)", type: "大佛手", names: ["彌勒圓識", "彌勒深益", "彌勒識正"], role: "志工", content: "捐血" },
  { date: "2026/10/24 (六)", type: "大佛手", names: ["彌勒覺志", "彌勒立嘉", "彌勒恆願"], role: "志工", content: "" },
  { date: "2026/10/25 (日)", type: "大佛手", names: ["彌勒賢意", "彌勒擇智", "彌勒敏躍"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/10/26 (一)", type: "大佛手", names: ["彌勒淨元", "彌勒覺行", "彌勒靜延"], role: "志工", content: "列假日補假 (光復節)" },
  { date: "2026/10/31 (六)", type: "大佛手", names: ["彌勒耀潔", "彌勒延群", "彌勒敬正"], role: "志工", content: "皇母成道日法會" },
  { date: "2026/11/1 (日)", type: "大佛手", names: ["彌勒世振", "彌勒慧明", "彌勒靜羽"], role: "志工", content: "皇母成道日法會 禮佛日 農曆9月23日" },
  { date: "2026/11/7 (六)", type: "大佛手", names: ["馬諭姍", "彌勒樂禪", "彌勒成智"], role: "志工", content: "" },
  { date: "2026/11/8 (日)", type: "大佛手", names: ["彌勒慧訣", "彌勒旻賢", "彌勒圓識"], role: "志工", content: "" },
  { date: "2026/11/14 (六)", type: "大佛手", names: ["彌勒仁辰", "彌勒潔聞", "彌勒仁誠"], role: "志工", content: "" },
  { date: "2026/11/15 (日)", type: "大佛手", names: ["彌勒順塵", "彌勒毅仁", "彌勒義誠"], role: "志工", content: "彌勒一貫道講座＋慶生會" },
  { date: "2026/11/21 (六)", type: "大佛手", names: ["彌勒恆願", "彌勒羽塵", "彌勒立嘉"], role: "志工", content: "" },
  { date: "2026/11/22 (日)", type: "大佛手", names: ["彌勒元照", "李筠婓", "彌勒延真"], role: "志工", content: "捐血" },
  { date: "2026/11/28 (六)", type: "大佛手", names: ["廖詠媗", "彌勒故明", "彌勒潔仁"], role: "志工", content: "" },
  { date: "2026/11/29 (日)", type: "大佛手", names: ["彌勒塵耀", "彌勒勝棋", "彌勒語立"], role: "志工", content: "" },
  { date: "2026/12/5 (六)", type: "大佛手", names: ["彌勒明利", "彌勒塵寧", "彌勒佑正"], role: "志工", content: "" },
  { date: "2026/12/6 (日)", type: "大佛手", names: ["彌勒意能", "彌勒澄明", "彌勒淨慧"], role: "志工", content: "禮佛日" },
  { date: "2026/12/12 (六)", type: "大佛手", names: ["彌勒識正", "彌勒覺志", "彌勒立嘉"], role: "志工", content: "" },
  { date: "2026/12/13 (日)", type: "大佛手", names: ["彌勒敏躍", "彌勒賢意", "彌勒擇智"], role: "志工", content: "捐血、彌勒一貫道講座＋慶生會" },
  { date: "2026/12/19 (六)", type: "大佛手", names: ["彌勒恆願", "彌勒淨元", "彌勒覺行"], role: "志工", content: "" },
  { date: "2026/12/20 (日)", type: "大佛手", names: ["彌勒靜延", "彌勒耀潔", "彌勒延群"], role: "志工", content: "" },
  { date: "2026/12/25 (五)", type: "大佛手", names: ["彌勒敬正", "彌勒世振", "彌勒慧訣"], role: "志工", content: "列假日補假 (行憲紀念日)" },
  { date: "2026/12/26 (六)", type: "大佛手", names: ["廖詠媗", "馬諭姍", "彌勒樂禪"], role: "志工", content: "" },
  { date: "2026/12/27 (日)", type: "大佛手", names: ["彌勒深益", "彌勒馥真", "彌勒仁誠"], role: "志工", content: "嚴聖尊佛成道日法會 農曆11月19日" },

  // --- 護衛隊 ---
  { date: "2026/1/1 (四)", type: "護衛隊", names: ["彌勒提智"], role: "隊員" },
  { date: "2026/1/2 (五)", type: "護衛隊", names: ["彌勒易決", "彌勒正識"], role: "隊員" },
  { date: "2026/1/3 (六)", type: "護衛隊", names: ["彌勒澄明", "彌勒順塵"], role: "隊員" },
  { date: "2026/1/5 (一)", type: "護衛隊", names: ["彌勒語行", "彌勒世振"], role: "隊員" },
  { date: "2026/1/6 (二)", type: "護衛隊", names: ["彌勒故明", "彌勒詞仁"], role: "隊員" },
  { date: "2026/1/7 (三)", type: "護衛隊", names: ["彌勒成智"], role: "隊員" },
  { date: "2026/1/8 (四)", type: "護衛隊", names: ["彌勒延群"], role: "隊員" },
  { date: "2026/1/9 (五)", type: "護衛隊", names: ["彌勒易決", "彌勒誠識"], role: "隊員" },
  { date: "2026/1/10 (六)", type: "護衛隊", names: ["彌勒提智", "彌勒武仁"], role: "隊員" },
  { date: "2026/1/12 (一)", type: "護衛隊", names: ["彌勒語行", "彌勒世振"], role: "隊員" },
  { date: "2026/1/13 (二)", type: "護衛隊", names: ["彌勒敏躍", "彌勒德智"], role: "隊員" },
  { date: "2026/1/14 (三)", type: "護衛隊", names: ["彌勒成智"], role: "隊員" },
  { date: "2026/1/15 (四)", type: "護衛隊", names: ["彌勒延群"], role: "隊員" },
  { date: "2026/1/16 (五)", type: "護衛隊", names: ["彌勒易決", "彌勒誠識"], role: "隊員" },
  { date: "2026/1/17 (六)", type: "護衛隊", names: ["彌勒澄明", "彌勒順塵"], role: "隊員" },
  { date: "2026/1/19 (一)", type: "護衛隊", names: ["彌勒語行", "彌勒世振"], role: "隊員" },
  { date: "2026/1/20 (二)", type: "護衛隊", names: ["彌勒故明"], role: "隊員" },
  { date: "2026/1/21 (三)", type: "護衛隊", names: ["彌勒達仁"], role: "隊員" },
  { date: "2026/1/22 (四)", type: "護衛隊", names: ["彌勒易賢"], role: "隊員" },
  { date: "2026/1/23 (五)", type: "護衛隊", names: ["彌勒易決", "彌勒正識"], role: "隊員" },
  { date: "2026/1/24 (六)", type: "護衛隊", names: ["彌勒提智", "彌勒武仁"], role: "隊員" },
  { date: "2026/1/26 (一)", type: "護衛隊", names: ["彌勒敏躍", "彌勒詞仁"], role: "隊員" },
  { date: "2026/1/27 (二)", type: "護衛隊", names: ["彌勒故明", "彌勒德智"], role: "隊員" },
  { date: "2026/1/28 (三)", type: "護衛隊", names: ["彌勒達仁"], role: "隊員" },
  { date: "2026/1/29 (四)", type: "護衛隊", names: ["彌勒易賢"], role: "隊員" },
  { date: "2026/1/30 (五)", type: "護衛隊", names: ["彌勒易決", "彌勒誠識"], role: "隊員" },
  { date: "2026/1/31 (六)", type: "護衛隊", names: ["彌勒澄明", "彌勒順塵"], role: "隊員" },

  // --- 道場功法 (Updated) ---
 { date: "2026/1/5 (一)", type: "道場功法", names: ["仁行教練", "敬合助教"], role: "教練/助教", content: "養生1-3" },
 { date: "2026/1/12 (一)", type: "道場功法", names: ["一鳴教練", "世振助教"], role: "教練/助教", content: "養生4-6" },
 { date: "2026/1/13 (二)", type: "道場功法", names: ["順塵教練", "躍宏教練"], role: "教練/助教", content: "12瓣-1,2" },
 { date: "2026/1/19 (一)", type: "道場功法", names: ["樂禪教練", "禮益助教"], role: "教練/助教", content: "養生7-9" },
 { date: "2026/1/20 (二)", type: "道場功法", names: ["誠識教練", "澄明助教"], role: "教練/助教", content: "12瓣-3" },
 { date: "2026/1/26 (一)", type: "道場功法", names: ["宜誠教練", "盡覺助教"], role: "教練/助教", content: "(玄舞功)" },
 { date: "2026/1/27 (二)", type: "道場功法", names: ["敏躍教練", "天振助教"], role: "教練/助教", content: "12瓣4,5" },
 { date: "2026/2/2 (一)", type: "道場功法", names: ["仁行教練", "澄明助教"], role: "教練/助教", content: "養生10-12" },
 { date: "2026/2/9 (一)", type: "道場功法", names: ["樂禪教練", "世振助教"], role: "教練/助教", content: "養生13-14" },
 { date: "2026/2/10 (二)", type: "道場功法", names: ["順塵教練", "天振助教"], role: "教練/助教", content: "12瓣-6,7" },
 { date: "2026/2/23 (一)", type: "道場功法", names: ["宜誠教練", "盡覺助教"], role: "教練/助教", content: "(玄舞功)" },
 { date: "2026/2/24 (二)", type: "道場功法", names: ["一鳴教練", "敬合助教"], role: "教練/助教", content: "12瓣-7,8" },
 { date: "2026/3/2 (一)", type: "道場功法", names: ["宜誠教練", "盡覺助教"], role: "教練/助教", content: "(玄舞功)" },
 { date: "2026/3/30 (一)", type: "道場功法", names: ["宜誠教練", "盡覺助教"], role: "教練/助教", content: "(玄舞功)" },

  // --- 大正功法 ---
  { date: "2026/1/4 (日)", type: "大正功法", names: ["彌勒念行", "彌勒敏躍", "彌勒靜羽"], role: "志工/學員", content: "養生功法 第二層24辦蓮花 互動教學" },
  { date: "2026/1/18 (日)", type: "大正功法", names: ["彌勒義誠", "彌勒順塵", "彌勒毅仁"], role: "志工/學員", content: "軟骨利筋 第二層24辦蓮花 互動教學" },
  { date: "2026/2/1 (日)", type: "大正功法", names: ["彌勒言", "彌妙恆", "彌勒逸賢"], role: "志工/學員", content: "養生功法 第二層24辦蓮花 互動教學" },
  { date: "2026/3/1 (日)", type: "大正功法", names: ["彌勒于青", "彌勒瑞仁", "彌勒信守"], role: "志工/學員", content: "軟骨利筋 第二層24辦蓮花 互動教學" },
  { date: "2026/3/15 (日)", type: "大正功法", names: ["彌勒旻賢", "彌勒育露", "彌勒禮益"], role: "志工/學員", content: "養生功法 第二層24辦蓮花 互動教學" },
  { date: "2026/3/22 (日)", type: "大正功法", names: ["彌勒澄明", "彌勒旻賢", "彌勒敬合"], role: "志工/學員", content: "軟骨利筋 第二層24辦蓮花 互動教學" },
  { date: "2026/4/5 (日)", type: "大正功法", names: ["彌勒一鳴", "彌勒樂禪", "彌勒羽塵"], role: "志工/學員", content: "養生功法 第二層24辦蓮花 互動教學" },
  { date: "2026/4/19 (日)", type: "大正功法", names: ["彌勒誠識", "彌勒成智", "彌勒仁行"], role: "志工/學員", content: "軟骨利筋 第二層24辦蓮花 互動教學" },
  { date: "2026/5/3 (日)", type: "大正功法", names: ["彌勒聞元", "彌勒靜羽", "彌天振"], role: "志工/學員", content: "養生功法 第二層24辦蓮花 互動教學" },

  // --- 讀書會 ---
  { date: "2026/1/17 (六)", type: "讀書會", names: ["彌勒行言"], role: "領讀人" },
  { date: "2026/2/28 (六)", type: "讀書會", names: ["彌勒樂禪"], role: "領讀人" },
  { date: "2026/3/21 (六)", type: "讀書會", names: ["彌勒澄明"], role: "領讀人" },
  { date: "2026/4/18 (六)", type: "讀書會", names: ["彌勒意能"], role: "領讀人" },
  { date: "2026/5/16 (六)", type: "讀書會", names: ["彌勒易賢"], role: "領讀人" },
  { date: "2026/6/13 (六)", type: "讀書會", names: ["彌勒淳萍"], role: "領讀人" },
  { date: "2026/7/18 (六)", type: "讀書會", names: ["彌勒學淨"], role: "領讀人" },
  { date: "2026/8/15 (六)", type: "讀書會", names: ["彌勒信永"], role: "領讀人" },
  { date: "2026/9/19 (六)", type: "讀書會", names: ["彌勒潔仁"], role: "領讀人" },
  { date: "2026/10/24 (六)", type: "讀書會", names: ["彌勒敬合"], role: "領讀人" },
  { date: "2026/11/14 (六)", type: "讀書會", names: ["彌勒意能"], role: "領讀人" },
  { date: "2026/12/12 (六)", type: "讀書會", names: ["彌勒行言"], role: "領讀人" },

  // --- 攝影座談 ---
  { date: "2026/1/18 (日)", type: "攝影座談", names: ["彌勒澄明"], role: "志工" },
  { date: "2026/2/1 (日)", type: "攝影座談", names: ["彌勒信守"], role: "志工" },
  { date: "2026/3/15 (日)", type: "攝影座談", names: ["彌勒誠識"], role: "志工" },
  { date: "2026/4/19 (日)", type: "攝影座談", names: ["彌勒理聞"], role: "志工" },
  { date: "2026/5/17 (日)", type: "攝影座談", names: ["彌勒澄明"], role: "志工" },
  { date: "2026/6/14 (日)", type: "攝影座談", names: ["彌勒信守"], role: "志工" },
  { date: "2026/7/19 (日)", type: "攝影座談", names: ["彌勒誠識"], role: "志工" },
  { date: "2026/8/16 (日)", type: "攝影座談", names: ["彌勒理聞"], role: "志工" },
  { date: "2026/9/20 (日)", type: "攝影座談", names: ["彌勒澄明"], role: "志工" },
  { date: "2026/10/25 (日)", type: "攝影座談", names: ["彌勒信守"], role: "志工" },
  { date: "2026/11/15 (日)", type: "攝影座談", names: ["彌勒誠識"], role: "志工" },
  { date: "2026/12/13 (日)", type: "攝影座談", names: ["彌勒理聞"], role: "志工" },
  
  // --- 北部頌缽 ---
  { date: "2026/1/18 (日)", type: "北部頌缽", names: ["彌勒易賢", "彌勒翔慈", "彌勒樂禪", "彌勒覺行", "彌勒覺志"], role: "志工", content: "B-5組" },
  { date: "2026/2/8 (日)", type: "北部頌缽", names: ["彌勒武仁", "彌勒善覺-彭芳箖", "彌勒詞仁", "彌勒耀潔", "謝櫂珺-語賢"], role: "志工", content: "A-6組" },
  { date: "2026/3/15 (日)", type: "北部頌缽", names: ["彌勒語行", "彌勒度塵", "彌勒聞元", "吳珺陽-信一", "馬諭姍-言諭"], role: "志工", content: "B-6 組" },
  { date: "2026/3/22 (日)", type: "北部頌缽", names: ["彌勒見明", "彌勒志湧", "李滄-乘毅", "彌勒潤為", "彌勒易為"], role: "志工", content: "A-7組" },
  { date: "2026/4/19 (日)", type: "北部頌缽", names: ["彌勒順塵", "彌勒敬正", "彌勒躍廣", "彌勒誠識", "彌勒立嘉"], role: "志工", content: "A-1組" },
  { date: "2026/5/17 (日)", type: "北部頌缽", names: ["彌勒易決", "彌勒故明", "彌勒啓昇", "彌勒德智", "彌勒育露"], role: "志工", content: "B-1組" },
  { date: "2026/5/24 (日)", type: "北部頌缽", names: ["彌勒一鳴", "彌勒瑞仁", "彌勒昂智-楊智璂", "彌勒虔慈-陳筣蕍", "彌勒擇智"], role: "志工", content: "A-2組" },
  { date: "2026/5/31 (日)", type: "北部頌缽", names: ["彌勒敏躍", "彌勒希仁", "彌勒靜延", "彌勒聞塵", "彌勒延群"], role: "志工", content: "B-2組" },
  { date: "2026/6/14 (日)", type: "北部頌缽", names: ["彌勒立能", "彌勒勝棋", "彌勒智方", "彌勒提智", "彌勒行慈"], role: "志工", content: "A-3組" },
  { date: "2026/7/12 (日)", type: "北部頌缽", names: ["彌勒澄明", "彌勒敬合", "羅鵬霖", "彌勒伏緣", "彌勒躍智"], role: "志工", content: "B-3組" },
  { date: "2026/7/19 (日)", type: "北部頌缽", names: ["彌勒世振", "彌勒忠敬", "彌勒形耀", "彌勒塵耀", "彌勒均賢"], role: "志工", content: "A-4組" },
  { date: "2026/7/26 (日)", type: "北部頌缽", names: ["彌勒成智", "彌勒仁行", "彌勒決立", "彌勒意生", "陳錡峰"], role: "志工", content: "B-4組" },
  { date: "2026/8/16 (日)", type: "北部頌缽", names: ["彌勒知行", "高詠昇-啟振", "楊海翎-慧毫", "彌勒真仁", "彌勒尼恒"], role: "志工", content: "A-5組" },
  { date: "2026/8/23 (日)", type: "北部頌缽", names: ["彌勒易賢", "彌勒翔慈", "彌勒樂禪", "彌勒覺行", "彌勒覺志"], role: "志工", content: "B-5組" },
  { date: "2026/9/13 (日)", type: "北部頌缽", names: ["彌勒武仁", "彌勒善覺-彭芳箖", "彌勒詞仁", "彌勒耀潔", "謝櫂珺-語賢"], role: "志工", content: "A-6組" },
  { date: "2026/9/20 (日)", type: "北部頌缽", names: ["彌勒語行", "彌勒度塵", "彌勒聞元", "吳珺陽-信一", "馬諭姍-言諭"], role: "志工", content: "B-6 組" },
  { date: "2026/10/11 (日)", type: "北部頌缽", names: ["彌勒見明", "彌勒志湧", "李滄-乘毅", "彌勒潤為", "彌勒易為"], role: "志工", content: "A-7組" },
  { date: "2026/10/25 (日)", type: "北部頌缽", names: ["彌勒順塵", "彌勒敬正", "彌勒躍廣", "彌勒誠識", "彌勒立嘉"], role: "志工", content: "A-1組" },
  { date: "2026/11/15 (日)", type: "北部頌缽", names: ["彌勒易決", "彌勒故明", "彌勒啓昇", "彌勒德智", "彌勒育露"], role: "志工", content: "B-1組" },
  { date: "2026/11/29 (日)", type: "北部頌缽", names: ["彌勒一鳴", "彌勒瑞仁", "彌勒昂智-楊智璂", "彌勒虔慈-陳筣蕍", "彌勒擇智"], role: "志工", content: "A-2組" },
  { date: "2026/12/6 (日)", type: "北部頌缽", names: ["彌勒敏躍", "彌勒希仁", "彌勒靜延", "彌勒聞塵", "彌勒延群"], role: "志工", content: "B-2組" },
  { date: "2026/12/20 (日)", type: "北部頌缽", names: ["彌勒立能", "彌勒勝棋", "彌勒智方", "彌勒提智", "彌勒行慈"], role: "志工", content: "A-3組" }
];

// --- 月曆元件 ---
const CalendarView = ({ onDateSelect, eventDates }) => {
  const [currentDate, setCurrentDate] = useState(new Date(2026, 0, 1)); // 預設 2026 年 1 月

  const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
  const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

  const handlePrevMonth = () => {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
  };

  const handleNextMonth = () => {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
  };

  const daysInMonth = getDaysInMonth(currentDate.getFullYear(), currentDate.getMonth());
  const firstDay = getFirstDayOfMonth(currentDate.getFullYear(), currentDate.getMonth());
  
  const monthNames = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"];

  const renderDays = () => {
    const days = [];
    // 填補上個月的空白
    for (let i = 0; i < firstDay; i++) {
      days.push(<div key={`empty-${i}`} className="h-20 sm:h-24 bg-slate-50/50 border border-slate-100"></div>);
    }
    // 填入當月日期
    for (let day = 1; day <= daysInMonth; day++) {
      // 格式化日期 key (YYYY/MM/DD) 以比對事件
      const dateKey = `${currentDate.getFullYear()}/${String(currentDate.getMonth() + 1).padStart(2, '0')}/${String(day).padStart(2, '0')}`;
      const hasEvent = eventDates.has(dateKey);
      
      // 判斷是否為週末
      const dayOfWeek = (firstDay + day - 1) % 7;
      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

      days.push(
        <div 
          key={day} 
          onClick={() => onDateSelect(dateKey)}
          className={`h-20 sm:h-24 border border-slate-200 bg-white hover:bg-emerald-50 transition cursor-pointer p-1 sm:p-2 flex flex-col relative group
            ${isWeekend ? 'bg-slate-50' : ''}`}
        >
          <span className={`text-sm font-semibold w-6 h-6 flex items-center justify-center rounded-full 
            ${isWeekend ? 'text-red-500' : 'text-slate-700'} 
            ${hasEvent ? 'bg-emerald-100 text-emerald-800' : ''}`}
          >
            {day}
          </span>
          
          {hasEvent && (
            <div className="mt-1 flex flex-wrap gap-1 content-start">
               <span className="w-1.5 h-1.5 rounded-full bg-emerald-500 block"></span>
               <span className="text-[10px] text-emerald-600 font-medium hidden sm:inline truncate w-full">有點擊查看</span>
            </div>
          )}
        </div>
      );
    }
    return days;
  };

  return (
    <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden mb-6">
      {/* Calendar Header */}
      <div className="flex items-center justify-between px-6 py-4 bg-emerald-50 border-b border-emerald-100">
        <button onClick={handlePrevMonth} className="p-2 hover:bg-emerald-200 rounded-full transition text-emerald-800">
          <ChevronLeft className="w-5 h-5" />
        </button>
        <h2 className="text-xl font-bold text-emerald-900">
          {currentDate.getFullYear()} 年 {monthNames[currentDate.getMonth()]}
        </h2>
        <button onClick={handleNextMonth} className="p-2 hover:bg-emerald-200 rounded-full transition text-emerald-800">
          <ChevronRight className="w-5 h-5" />
        </button>
      </div>

      {/* Weekday Headers */}
      <div className="grid grid-cols-7 border-b border-slate-200 bg-slate-50 text-center py-2 text-sm font-medium text-slate-500">
        <div className="text-red-500">日</div>
        <div>一</div>
        <div>二</div>
        <div>三</div>
        <div>四</div>
        <div>五</div>
        <div className="text-green-600">六</div>
      </div>

      {/* Days Grid */}
      <div className="grid grid-cols-7 bg-slate-100 gap-px border-b border-slate-200">
        {renderDays()}
      </div>
    </div>
  );
};

// --- System Message Modal ---
const SystemMessageModal = ({ isOpen, onClose, title, message, type }) => {
  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[80] animate-fadeIn">
       <div className="bg-white rounded-xl shadow-xl max-w-sm w-full p-6 border-2 border-slate-100">
         <div className="text-center">
            {type === 'error' ? <XCircle className="w-10 h-10 text-red-500 mx-auto mb-3" /> : <Info className="w-10 h-10 text-blue-500 mx-auto mb-3" />}
            <h3 className="text-lg font-bold text-slate-800 mb-2">{title}</h3>
            <p className="text-slate-600 mb-6 whitespace-pre-line">{message}</p>
            <button onClick={onClose} className="bg-slate-800 text-white px-6 py-2 rounded-lg hover:bg-slate-700 transition">確定</button>
         </div>
       </div>
    </div>
  )
}

// --- 主應用程式 ---
const App = () => {
  const [rawData, setRawData] = useState([]);
  const [dataVersion, setDataVersion] = useState(DEFAULT_DATA_VERSION);
  const [searchTerm, setSearchTerm] = useState('');
  const [searchType, setSearchType] = useState('name');
  const [searchUnit, setSearchUnit] = useState('所有單位');
  const [results, setResults] = useState([]);
  const [isUpdateModalOpen, setIsUpdateModalOpen] = useState(false);
  const [updateInput, setUpdateInput] = useState('');
  const [isXlsxReady, setIsXlsxReady] = useState(false);
  const [passwordInput, setPasswordInput] = useState('');
  const [isAuthorized, setIsAuthorized] = useState(false);
  const [updateMessage, setUpdateMessage] = useState({ type: '', text: '' });
  
  // App Update States
  const [latestAppInfo, setLatestAppInfo] = useState(null); 
  const [isCheckingAppUpdate, setIsCheckingAppUpdate] = useState(false);
  const [showUpdateModal, setShowUpdateModal] = useState(false);
  
  // System Message State
  const [systemMessage, setSystemMessage] = useState({ isOpen: false, title: '', message: '', type: 'info' });

  // 視圖狀態
  const [viewMode, setViewMode] = useState('list');

  // 初始化：載入資料與歷史連結
  useEffect(() => {
    const savedData = localStorage.getItem('schedule_data');
    const savedVersion = localStorage.getItem('schedule_version');
    if (savedData) {
      try {
        setRawData(JSON.parse(savedData));
        setDataVersion(savedVersion || DEFAULT_DATA_VERSION);
      } catch (e) {
        setRawData(INITIAL_RAW_DATA);
      }
    } else {
      setRawData(INITIAL_RAW_DATA);
    }

    const storedAppInfo = localStorage.getItem('latest_app_info');
    if (storedAppInfo) {
      setLatestAppInfo(JSON.parse(storedAppInfo));
    }
  }, []);

  // 動態載入 SheetJS 並在完成後自動檢查更新
  useEffect(() => {
    if (window.XLSX) {
      setIsXlsxReady(true);
      checkForAppUpdate(true);
      return;
    }
    const script = document.createElement('script');
    script.src = "https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js";
    script.onload = () => {
      setIsXlsxReady(true);
      checkForAppUpdate(true);
    };
    document.head.appendChild(script);
  }, []);

  // 檢查更新函式
  const checkForAppUpdate = async (isSilent = false) => {
    if (!window.XLSX) return;
    
    if (!isSilent) setIsCheckingAppUpdate(true);
    
    try {
      const response = await fetchWithProxy(UPDATE_MANAGER_URL);
      if (!response.ok) throw new Error("無法連接更新伺服器");
      
      const csvText = await response.text();
      const workbook = window.XLSX.read(csvText, { type: 'string' });
      const firstSheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheetName];
      const data = window.XLSX.utils.sheet_to_json(worksheet);

      let foundLink = null;
      let foundDate = null;

      data.forEach(row => {
        const dateKey = Object.keys(row).find(k => /日期|Date/i.test(k));
        const linkKey = Object.keys(row).find(k => /連結|網址|Link|Share/i.test(k));
        
        if (dateKey && linkKey) {
           const rowDate = row[dateKey];
           const rowLink = row[linkKey];
           if (rowDate && rowLink && String(rowDate).includes('2026')) {
              foundLink = rowLink;
              foundDate = rowDate;
           }
        }
      });

      if (foundLink) {
        const newInfo = { url: foundLink, date: foundDate };
        setLatestAppInfo(newInfo);
        localStorage.setItem('latest_app_info', JSON.stringify(newInfo));
        
        if (!isSilent) {
           setShowUpdateModal(true);
        }
      } else {
        if (!isSilent) {
            setSystemMessage({
                isOpen: true,
                title: "檢查完成",
                message: "目前已是最新版本，未發現新的更新紀錄。",
                type: 'info'
            });
        }
      }

    } catch (error) {
      console.error(error);
      if (!isSilent) {
          setSystemMessage({
                isOpen: true,
                title: "檢查更新失敗",
                message: `無法取得更新資訊。\n原因: ${error.message}`,
                type: 'error'
            });
      }
    } finally {
      if (!isSilent) setIsCheckingAppUpdate(false);
    }
  };

  const flattenedData = useMemo(() => {
    return rawData.flatMap(entry => {
      const displayDate = ensureYearInString(entry.date);
      const normDate = normalizeDate(entry.date);
      const nameList = Array.isArray(entry.names) ? entry.names : [entry.names];
      
      return nameList.map(name => ({
        id: Math.random().toString(36).substr(2, 9),
        rawDate: displayDate,
        date: normDate,
        type: entry.type,
        name: name,
        role: entry.role,
        content: entry.content || "" 
      })).filter(item => item.name && item.name !== "待定");
    });
  }, [rawData]);

  const availableUnits = useMemo(() => {
    const units = new Set(flattenedData.map(item => item.type));
    return ['所有單位', ...Array.from(units).sort()];
  }, [flattenedData]);

  const eventDates = useMemo(() => {
    const dates = new Set();
    results.forEach(item => {
        dates.add(item.date);
    });
    return dates;
  }, [results]); 

  const handleCalendarDateClick = (dateStr) => {
    setSearchType('date');
    setSearchTerm(dateStr);
  };

  const handleOpenUpdateModal = () => {
    setIsUpdateModalOpen(true);
    setIsAuthorized(false);
    setPasswordInput('');
    setUpdateMessage({ type: '', text: '' });
    setUpdateInput('');
  };

  const handleVerifyPassword = () => {
    if (passwordInput === '730317') {
      setIsAuthorized(true);
    } else {
      alert("密碼錯誤，請重新輸入");
      setPasswordInput('');
    }
  };

  const parseComplexJson = (jsonObj) => {
    const parsedData = [];
    if (!jsonObj.排班表) return null;
    const scheduleMap = jsonObj.排班表;

    Object.keys(scheduleMap).forEach(key => {
      const items = scheduleMap[key];
      let typeName = key.replace('2026_', '').replace(/_/g, '');

      if (key.includes('護衛隊')) {
        typeName = '護衛隊';
        if (typeof items === 'object' && !Array.isArray(items)) {
          Object.keys(items).forEach(subKey => {
            if (Array.isArray(items[subKey])) {
              items[subKey].forEach(item => {
                parsedData.push({
                  date: ensureYearInString(item.日期),
                  type: typeName,
                  names: item.志工 || [],
                  role: '隊員',
                  content: ''
                });
              });
            }
          });
        }
        return;
      }

      if (Array.isArray(items)) {
        items.forEach(item => {
          if (item.備註 && !item.日期) return;
          let names = [];
          let role = '志工';
          let content = item.活動 || item.內容 || item.備註 || '';

          if (key.includes('大佛手')) {
            names = item.志工名單 || [];
          } else if (key.includes('大愛')) {
            names = [item.志工];
          } else if (key.includes('道場功法')) {
            role = '教練/助教';
            if (item.教練 && item.教練 !== '待定') names.push(`${item.教練}(教練)`);
            if (item.助教 && item.助教 !== '待定') names.push(`${item.助教}(助教)`);
          } else if (key.includes('大正功法')) {
            names = item.名單 || [];
            role = '志工/學員';
          } else if (key.includes('讀書會')) {
            role = '領讀人';
            names = [item.領讀人];
          } else if (key.includes('攝影')) {
            names = [item.志工];
          } else {
            names = item.志工 ? (Array.isArray(item.志工) ? item.志工 : [item.志工]) : 
                   item.名單 ? item.名單 : [];
          }

          if (names.length > 0) {
            parsedData.push({
              date: ensureYearInString(item.日期),
              type: typeName,
              names: names,
              role: role,
              content: content
            });
          }
        });
      }
    });
    return parsedData;
  };

  const processSheetData = (sheetJson, sheetName) => {
    const newData = [];
    let autoType = '未分類';
    if (sheetName.includes('大愛')) autoType = '大愛';
    else if (sheetName.includes('大佛手')) autoType = '大佛手';
    else if (sheetName.includes('護衛隊')) autoType = '護衛隊';
    else if (sheetName.includes('道場功法') || sheetName.includes('道場')) autoType = '道場功法';
    else if (sheetName.includes('大正功法') || sheetName.includes('大正')) autoType = '大正功法';
    else if (sheetName.includes('讀書會')) autoType = '讀書會';
    else if (sheetName.includes('攝影')) autoType = '攝影座談';

    sheetJson.forEach(row => {
      let date = row['日期'] || row['Date'] || row['date'];
      const type = row['單位'] || row['種類'] || row['Type'] || row['type'] || autoType;
      let namesRaw = row['姓名'] || row['志工'] || row['人員'] || row['Names'] || row['names'] || '';
      const role = row['職務'] || row['角色'] || row['Role'] || row['role'] || '志工';
      const content = row['內容'] || row['活動'] || row['備註'] || row['Content'] || row['content'] || '';

      if (!date) return;
      date = ensureYearInString(String(date));

      let names = [];
      if (typeof namesRaw === 'string') {
        names = namesRaw.split(/[，,、\s]+/).filter(n => n.trim());
      } else if (Array.isArray(namesRaw)) {
        names = namesRaw;
      } else if (namesRaw) {
        names = [String(namesRaw)];
      }

      if (names.length > 0) {
        newData.push({
          date: date,
          type: String(type),
          names: names,
          role: String(role),
          content: String(content)
        });
      }
    });
    return newData;
  };

  const handleDataUpdate = async () => {
    setUpdateMessage({ type: 'info', text: '處理中...' });
    let rawJson = null;
    let finalData = null;
    let newVersion = null;

    try {
      let input = updateInput.trim();
      const sheetCsvUrl = getGoogleSheetXlsxUrl(input);
      
      if (sheetCsvUrl) {
         if (!window.XLSX) throw new Error("Excel 解析元件尚未載入完成，請稍後再試");
         setUpdateMessage({ type: 'info', text: '正在從 Google Sheet 下載資料 (Multi-sheet)...' });
         try {
           const response = await fetchWithProxy(sheetCsvUrl);
           if (!response.ok) throw new Error(`下載失敗 (Status: ${response.status})`);
           const arrayBuffer = await response.arrayBuffer();
           const workbook = window.XLSX.read(arrayBuffer, { type: 'array' });
           let allSheetsData = [];
           workbook.SheetNames.forEach(sheetName => {
             if (sheetName.includes('2026_')) {
                const worksheet = workbook.Sheets[sheetName];
                const sheetJson = window.XLSX.utils.sheet_to_json(worksheet);
                const processedData = processSheetData(sheetJson, sheetName);
                allSheetsData = [...allSheetsData, ...processedData];
             }
           });
           if (allSheetsData.length > 0) {
             finalData = allSheetsData;
             newVersion = `Sheet ${new Date().toISOString().slice(0, 10).replace(/-/g, '.')}`;
           } else {
             throw new Error("在試算表中找不到任何名稱包含 '2026_' 的工作表，或工作表內無有效資料。");
           }
         } catch (fetchErr) {
           console.error("Sheet fetch error:", fetchErr);
           throw new Error(`讀取 Google Sheet 失敗: ${fetchErr.message}`);
         }
      } else {
        if (input.startsWith('http://') || input.startsWith('https://')) {
          try {
            const response = await fetch(input);
            if (!response.ok) throw new Error('網路請求失敗');
            rawJson = await response.json();
          } catch (fetchError) {
            console.warn("URL Fetch failed, trying text parse...", fetchError);
          }
        }

        if (!rawJson && !finalData) {
          try {
              const textData = parseRawTextData(input);
              if (textData.length > 5) {
                  finalData = textData;
                  newVersion = `SmartText ${new Date().toISOString().slice(0, 10).replace(/-/g, '.')}`;
              }
          } catch (e) {
              console.log("Text parse not ideal, trying JSON");
          }

          if (!finalData) {
            if (input.includes('```')) input = input.replace(/```json/g, '').replace(/```/g, '');
            const firstBrace = input.indexOf('{');
            const firstBracket = input.indexOf('[');
            let startIndex = -1;
            if (firstBrace !== -1 && firstBracket !== -1) startIndex = Math.min(firstBrace, firstBracket);
            else if (firstBrace !== -1) startIndex = firstBrace;
            else if (firstBracket !== -1) startIndex = firstBracket;

            if (startIndex !== -1) {
                input = input.substring(startIndex);
                const lastBrace = input.lastIndexOf('}');
                const lastBracket = input.lastIndexOf(']');
                let endIndex = Math.max(lastBrace, lastBracket);
                if (endIndex !== -1) input = input.substring(0, endIndex + 1);
                
                try {
                    rawJson = JSON.parse(input);
                } catch (e) {
                    if (!finalData) throw new Error(`無法解析資料。請確認是有效的 JSON，或是直接貼上表格文字。`);
                }
            }
          }
        }
        
        if (rawJson) {
           if (rawJson.排班表) {
             finalData = parseComplexJson(rawJson);
             if (rawJson.版本) newVersion = rawJson.版本;
           } else if (Array.isArray(rawJson)) {
             finalData = rawJson;
           }
        }
      }

      if (finalData && finalData.length > 0) {
        setRawData(finalData);
        const versionToSet = newVersion || `Data ${new Date().toISOString().slice(0, 10).replace(/-/g, '.')}`;
        setDataVersion(versionToSet);
        localStorage.setItem('schedule_data', JSON.stringify(finalData));
        localStorage.setItem('schedule_version', versionToSet);
        setUpdateMessage({ type: 'success', text: `更新成功！載入 ${finalData.length} 筆資料 (來自多個工作表)。` });
        setTimeout(() => {
          setIsUpdateModalOpen(false);
          setUpdateMessage({ type: '', text: '' });
        }, 1500);
      } else {
        throw new Error('無法從輸入中解析出有效資料。請確認格式。');
      }
    } catch (error) {
      setUpdateMessage({ type: 'error', text: `更新失敗: ${error.message}` });
    }
  };

  const handleResetData = () => {
    if (window.confirm("確定要重置回預設資料嗎？")) {
      setRawData(INITIAL_RAW_DATA);
      setDataVersion(DEFAULT_DATA_VERSION);
      localStorage.removeItem('schedule_data');
      localStorage.removeItem('schedule_version');
      setUpdateMessage({ type: 'success', text: '已重置為預設資料。' });
      setTimeout(() => setIsUpdateModalOpen(false), 1000);
    }
  };

  useEffect(() => {
    let filtered = flattenedData;
    if (searchUnit !== '所有單位') {
      filtered = filtered.filter(item => item.type === searchUnit);
    }
    if (searchTerm.trim()) {
      const lowerTerm = searchTerm.toLowerCase();
      filtered = filtered.filter(item => {
        if (searchType === 'name') return item.name.toLowerCase().includes(lowerTerm);
        else return item.date.includes(lowerTerm) || item.rawDate.includes(lowerTerm);
      });
    } else {
      if (searchUnit === '所有單位') {
         filtered = [];
      }
    }
    filtered.sort((a, b) => a.date.localeCompare(b.date));
    setResults(filtered);
  }, [searchTerm, searchType, searchUnit, flattenedData]);

  const handleExportTxt = () => {
    if (results.length === 0) return;
    let content = `排班表查詢結果 - 單位:${searchUnit} | 搜尋:${searchTerm || '(無)'}\n`;
    content += `匯出時間: ${new Date().toLocaleString()}\n\n`;
    content += `日期\t\t單位\t\t姓名\t\t職務/內容\n`;
    content += `----------------------------------------------------------\n`;
    results.forEach(item => {
      content += `${item.rawDate}\t${item.type}\t${item.name}\t${item.role} ${item.content ? `(${item.content})` : ''}\n`;
    });
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `schedule_export.txt`;
    link.click();
    URL.revokeObjectURL(url);
  };

  const handleExportXlsx = () => {
    if (results.length === 0 || !isXlsxReady || !window.XLSX) {
      alert("Excel 匯出功能尚未準備好，請稍候再試。");
      return;
    }
    const dataToExport = results.map(item => ({
      "日期": item.rawDate,
      "單位": item.type,
      "姓名": item.name,
      "職務": item.role,
      "備註/內容": item.content
    }));
    const ws = window.XLSX.utils.json_to_sheet(dataToExport);
    const wb = window.XLSX.utils.book_new();
    window.XLSX.utils.book_append_sheet(wb, ws, "查詢結果");
    window.XLSX.writeFile(wb, `schedule_export.xlsx`);
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex flex-col">
      {/* Header */}
      <header className="bg-emerald-700 text-white shadow-lg shrink-0">
        <div className="max-w-5xl mx-auto px-4 py-4">
          <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
              <h1 className="text-2xl font-bold flex items-center gap-2">
                <Calendar className="w-8 h-8" />
                志工排班查詢系統 2026
              </h1>
              
              <div className="flex flex-col gap-1 mt-1">
                <div className="flex items-center gap-3 text-sm opacity-90">
                   <span className="font-mono bg-emerald-800 px-2 py-0.5 rounded flex items-center gap-1">
                     <Database className="w-3 h-3" /> {dataVersion}
                   </span>
                   <span className="font-mono bg-emerald-600 px-2 py-0.5 rounded opacity-80 text-xs">
                     {APP_VERSION}
                   </span>
                </div>
                
                {latestAppInfo && (
                  <div className="flex items-center gap-2 text-xs text-yellow-100 bg-emerald-800/50 p-1.5 rounded border border-emerald-600 mt-1">
                    <Cloud className="w-3 h-3" />
                    <span>最新發布 ({latestAppInfo.date}): </span>
                    <a 
                      href={latestAppInfo.url} 
                      target="_blank" 
                      rel="noopener noreferrer"
                      className="underline hover:text-white flex items-center gap-1 font-mono"
                    >
                      {latestAppInfo.url.substring(0, 30)}...
                      <ExternalLink className="w-3 h-3" />
                    </a>
                  </div>
                )}
              </div>
            </div>
            
            <div className="flex gap-2 items-center">
              <button 
                onClick={() => checkForAppUpdate(false)}
                disabled={isCheckingAppUpdate}
                className="flex items-center gap-2 bg-emerald-800 hover:bg-emerald-900 transition px-3 py-2 rounded-lg text-sm font-medium shadow-sm border border-emerald-600 disabled:opacity-50"
                title="從雲端取得最新 App 版本"
              >
                {isCheckingAppUpdate ? <RefreshCw className="w-4 h-4 animate-spin" /> : <Cloud className="w-4 h-4" />}
                {isCheckingAppUpdate ? "檢查中..." : "檢查 App 更新"}
              </button>

              <button 
                onClick={handleOpenUpdateModal}
                className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 transition px-4 py-2 rounded-lg text-sm font-medium border border-emerald-500 shadow-sm"
              >
                <RefreshCw className="w-4 h-4" />
                更新資料來源
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-5xl mx-auto px-4 py-8 flex-grow w-full">
        {/* Notice for Updates */}
        <div className="bg-blue-50 border border-blue-100 rounded-lg p-3 mb-6 flex items-start gap-3 text-sm text-blue-800">
           <AlertCircle className="w-5 h-5 shrink-0 mt-0.5" />
           <div>
             <p><strong>資料更新說明：</strong></p>
             <ul className="list-disc list-inside mt-1 space-y-1 text-blue-700">
               <li><strong>志工排班包含下列志工：</strong> 大愛、大佛手、道場功法、大正功法、護衛隊、讀書會、攝影座談會。</li>
               <li>點擊「檢查 App 更新」可從雲端確認是否有新程式版本。</li>
              </ul>
           </div>
        </div>

        {/* Search Controls */}
        <div className="bg-white rounded-xl shadow-md p-6 mb-8 border border-slate-200">
          <div className="flex flex-col gap-4">
            
            {/* View Mode Toggle */}
            <div className="flex justify-end border-b border-slate-100 pb-4">
               <div className="flex bg-slate-100 p-1 rounded-lg">
                  <button
                    onClick={() => setViewMode('list')}
                    className={`flex items-center gap-2 px-4 py-1.5 rounded-md text-sm font-medium transition-all ${
                      viewMode === 'list' ? 'bg-white text-emerald-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'
                    }`}
                  >
                    <List className="w-4 h-4" />
                    列表模式
                  </button>
                  <button
                    onClick={() => setViewMode('calendar')}
                    className={`flex items-center gap-2 px-4 py-1.5 rounded-md text-sm font-medium transition-all ${
                      viewMode === 'calendar' ? 'bg-white text-emerald-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'
                    }`}
                  >
                    <Grid className="w-4 h-4" />
                    月曆模式
                  </button>
               </div>
            </div>

            {/* Top Row: Unit Filter & Search Type */}
            <div className="flex flex-col sm:flex-row gap-4">
               <div className="relative min-w-[160px]">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <Filter className="h-4 w-4 text-emerald-600" />
                  </div>
                  <select
                    value={searchUnit}
                    onChange={(e) => setSearchUnit(e.target.value)}
                    className="block w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg leading-5 bg-slate-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-slate-700 font-medium transition-all shadow-sm appearance-none cursor-pointer"
                  >
                    {availableUnits.map(unit => (
                      <option key={unit} value={unit}>{unit}</option>
                    ))}
                  </select>
                  <div className="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg className="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                  </div>
               </div>

               <div className="flex bg-slate-100 p-1 rounded-lg shrink-0">
                <button
                  onClick={() => setSearchType('name')}
                  className={`flex items-center justify-center gap-2 px-4 py-2 rounded-md transition-all ${
                    searchType === 'name' ? 'bg-white text-emerald-700 shadow-sm font-bold' : 'text-slate-500 hover:text-slate-700'
                  }`}
                >
                  <User className="w-4 h-4" />
                  查姓名
                </button>
                <button
                  onClick={() => setSearchType('date')}
                  className={`flex items-center justify-center gap-2 px-4 py-2 rounded-md transition-all ${
                    searchType === 'date' ? 'bg-white text-emerald-700 shadow-sm font-bold' : 'text-slate-500 hover:text-slate-700'
                  }`}
                >
                  <Calendar className="w-4 h-4" />
                  查日期
                </button>
              </div>
            </div>

            {/* Input Field */}
            <div className="relative group w-full">
              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <Search className="h-5 w-5 text-slate-400 group-focus-within:text-emerald-500 transition-colors" />
              </div>
              <input
                type="text"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                placeholder={searchType === 'name' ? "輸入姓名 (例如: 彌勒澄明)..." : "輸入日期 (例如: 2026/01/01)..."}
                className="block w-full pl-10 pr-3 py-3 border border-slate-300 rounded-lg leading-5 bg-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all shadow-sm"
              />
            </div>
          </div>
        </div>

        {/* Content Area */}
        {viewMode === 'calendar' && (
          <div className="mb-6">
            <CalendarView onDateSelect={handleCalendarDateClick} eventDates={eventDates} />
          </div>
        )}
        
        {/* Results Area - Always Render */}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h2 className="text-xl font-semibold text-slate-700 flex items-center gap-2">
              <FileText className="w-5 h-5" />
              查詢結果 {results.length > 0 && <span className="text-sm font-normal text-slate-500">({results.length} 筆資料)</span>}
            </h2>
            
            {results.length > 0 && (
              <div className="flex gap-2">
                <button 
                  onClick={handleExportTxt}
                  className="flex items-center gap-1.5 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-md text-sm transition-colors border border-slate-300"
                >
                  <FileText className="w-4 h-4" />
                  TXT
                </button>
                <button 
                  onClick={handleExportXlsx}
                  disabled={!isXlsxReady}
                  title={!isXlsxReady ? "正在載入匯出元件..." : "匯出 Excel"}
                  className={`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm transition-colors border 
                    ${isXlsxReady ? 'bg-green-100 hover:bg-green-200 text-green-800 border-green-300 cursor-pointer' : 'bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed'}`}
                >
                  <FileSpreadsheet className="w-4 h-4" />
                  Excel
                </button>
              </div>
            )}
          </div>

          <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden min-h-[300px]">
            {searchTerm === '' && searchUnit === '所有單位' ? (
              <div className="flex flex-col items-center justify-center h-64 text-slate-400">
                <Search className="w-12 h-12 mb-2 opacity-20" />
                <p>請輸入查詢條件或選擇單位以開始搜尋</p>
              </div>
            ) : results.length === 0 ? (
              <div className="flex flex-col items-center justify-center h-64 text-slate-400">
                <Info className="w-12 h-12 mb-2 opacity-20" />
                <p>找不到符合的資料</p>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-slate-200">
                  <thead className="bg-slate-50">
                    <tr>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">日期</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">單位</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">姓名</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">職務 / 內容</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-slate-200">
                    {results.map((item) => (
                      <tr key={item.id} className="hover:bg-emerald-50 transition-colors group">
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-900 font-medium">{item.rawDate}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                          <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                            ${item.type.includes('大愛') ? 'bg-pink-100 text-pink-800' : 
                              item.type.includes('大佛手') ? 'bg-blue-100 text-blue-800' : 
                              item.type.includes('護衛隊') ? 'bg-gray-100 text-gray-800' :
                              'bg-purple-100 text-purple-800'}`}>
                            {item.type}
                          </span>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-700 font-bold">{item.name}</td>
                        <td className="px-6 py-4 text-sm text-slate-500">
                          {item.role}
                          {item.content && <span className="ml-2 text-slate-400">({item.content})</span>}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      </main>

      {/* App Update Notification Modal */}
      {showUpdateModal && latestAppInfo && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[60] animate-fadeIn">
          <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 transform transition-all border-2 border-emerald-500">
            <div className="text-center">
              <div className="mx-auto bg-emerald-100 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                <CheckCircle className="w-8 h-8 text-emerald-600" />
              </div>
              <h3 className="text-xl font-bold text-slate-800 mb-2">發現新版本！</h3>
              <div className="bg-slate-50 p-3 rounded-lg border border-slate-200 mb-4 text-left">
                <p className="text-sm text-slate-500 mb-1">發布日期：<span className="font-medium text-slate-800">{latestAppInfo.date}</span></p>
                <p className="text-sm text-slate-500 truncate" title={latestAppInfo.url}>連結：<span className="text-blue-600 underline cursor-pointer">{latestAppInfo.url}</span></p>
              </div>
              <p className="text-sm text-slate-600 mb-6">是否立即前往新版 App？</p>
              <div className="flex gap-3">
                <button 
                  onClick={() => setShowUpdateModal(false)}
                  className="flex-1 px-4 py-2 border border-slate-300 rounded-lg text-slate-600 hover:bg-slate-50 font-medium transition"
                >
                  稍後再說
                </button>
                <button 
                  onClick={() => {
                    window.open(latestAppInfo.url, '_blank');
                    setShowUpdateModal(false);
                  }}
                  className="flex-1 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-medium shadow-md flex items-center justify-center gap-2 transition"
                >
                  立即前往 <ArrowRight className="w-4 h-4" />
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* System Message Modal (For No Update or Error) */}
      <SystemMessageModal 
        isOpen={systemMessage.isOpen} 
        title={systemMessage.title}
        message={systemMessage.message}
        type={systemMessage.type}
        onClose={() => setSystemMessage(prev => ({ ...prev, isOpen: false }))}
      />

      {/* Update Data Modal (Original) */}
      {isUpdateModalOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 transform transition-all">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                <Settings className="w-5 h-5 text-emerald-600" />
                更新資料來源
              </h3>
              <button onClick={() => setIsUpdateModalOpen(false)} className="text-slate-400 hover:text-slate-600">✕</button>
            </div>
            
            {!isAuthorized ? (
              <div className="py-8 text-center">
                <div className="mx-auto bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                  <Lock className="w-8 h-8 text-slate-500" />
                </div>
                <h4 className="text-lg font-medium text-slate-800 mb-2">管理員驗證</h4>
                <p className="text-sm text-slate-500 mb-6">此功能僅限管理員使用，請輸入密碼。</p>
                <div className="max-w-xs mx-auto space-y-4">
                  <input
                    type="password"
                    value={passwordInput}
                    onChange={(e) => setPasswordInput(e.target.value)}
                    className="w-full px-4 py-2 border border-slate-300 rounded-lg text-center focus:ring-2 focus:ring-emerald-500 focus:outline-none"
                    placeholder="請輸入密碼"
                    onKeyDown={(e) => e.key === 'Enter' && handleVerifyPassword()}
                    autoFocus
                  />
                  <button onClick={handleVerifyPassword} className="w-full bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition shadow-sm font-medium">驗證身份</button>
                </div>
              </div>
            ) : (
              <div className="space-y-4 animate-fadeIn">
                <p className="text-sm text-slate-600 leading-relaxed">
                  請貼上 <strong>表格文字內容 (含標題)</strong>、<strong>Google Sheet 網址</strong> 或 <strong>JSON 格式資料</strong>。
                  <br/>
                  <span className="text-xs text-slate-400">
                    系統現在支援直接貼上從 NotebookLM 複製的雜亂表格文字。
                  </span>
                </p>
                
                <div>
                  <label className="block text-sm font-medium text-slate-700 mb-1">資料內容 / 網址</label>
                  <textarea
                    value={updateInput}
                    onChange={(e) => setUpdateInput(e.target.value)}
                    rows={6}
                    className="w-full border border-slate-300 rounded-md p-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm font-mono"
                    placeholder={`直接貼上表格文字 (如: | 1/1 | 彌勒澄明 | ...)\n或 Google Sheet 連結`}
                  />
                </div>

                {updateMessage.text && (
                  <div className={`p-3 rounded-md text-sm ${updateMessage.type === 'error' ? 'bg-red-50 text-red-700' : updateMessage.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-blue-50 text-blue-700'}`}>
                    {updateMessage.text}
                  </div>
                )}

                <div className="flex justify-between items-center mt-6">
                  <button onClick={handleResetData} className="text-xs text-red-400 hover:text-red-600 underline">重置為預設資料</button>
                  <div className="flex gap-3">
                    <button onClick={() => setIsUpdateModalOpen(false)} className="px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 transition">取消</button>
                    <button 
                      onClick={handleDataUpdate}
                      disabled={!updateInput.trim()}
                      className={`px-4 py-2 bg-emerald-600 text-white rounded-lg transition shadow-sm ${!updateInput.trim() ? 'opacity-50 cursor-not-allowed' : 'hover:bg-emerald-700'}`}
                    >
                      確認更新
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Footer */}
      <footer className="bg-slate-100 border-t border-slate-200 mt-auto py-6 shrink-0">
        <div className="max-w-5xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center text-slate-500 text-sm gap-2">
          <p>© 2026 志工排班管理系統 | 使用 React & Tailwind CSS 建置</p>
          <div className="flex items-center gap-2 bg-slate-200 px-3 py-1 rounded-full text-slate-600 font-medium">
             <Database className="w-4 h-4" />
             <span>資料庫總筆數: {flattenedData.length} 筆</span>
          </div>
        </div>
      </footer>
    </div>
  );
};


        /* 注意：你的原始碼最後一行是 `export default App;` 
           但在單一 HTML 檔案中不需要 export，請把該行刪除，改用下方的渲染程式碼。
        */

        // ==========================================
        // ↑↑↑ 程式碼貼上結束 ↑↑↑
        // ==========================================

        // 6. 啟動 React
        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
