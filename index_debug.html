<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿—å·¥æ’ç­æŸ¥è©¢ç³»çµ± 2026 - Debug Version</title>
    
    <style>
        /* åŸºæœ¬æ¨£å¼ï¼Œç¢ºä¿å³ä½¿ Tailwind å¤±æ•ˆä¹Ÿèƒ½çœ‹åˆ°å…§å®¹ */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        #debug-info {
            background: #fff;
            border: 2px solid #e74c3c;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        #debug-info h2 {
            color: #e74c3c;
            margin-top: 0;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        #root {
            min-height: 200px;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
    </style>

    <script>
        // ===== DEBUG ç³»çµ± =====
        window.debugInfo = {
            errors: [],
            warnings: [],
            success: [],
            startTime: Date.now()
        };

        // æ””æˆªæ‰€æœ‰éŒ¯èª¤
        window.addEventListener('error', function(e) {
            console.error('æ•ç²éŒ¯èª¤:', e);
            window.debugInfo.errors.push({
                message: e.message,
                source: e.filename,
                line: e.lineno,
                col: e.colno
            });
            updateDebugPanel();
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise éŒ¯èª¤:', e.reason);
            window.debugInfo.errors.push({
                message: 'Promise Rejection: ' + e.reason
            });
            updateDebugPanel();
        });

        function log(type, message) {
            console.log(`[${type}]`, message);
            window.debugInfo[type].push(message);
            updateDebugPanel();
        }

        function updateDebugPanel() {
            const panel = document.getElementById('debug-messages');
            if (!panel) return;
            
            let html = '<h3>ğŸ” è¨ºæ–·è¨Šæ¯</h3>';
            
            if (window.debugInfo.errors.length > 0) {
                html += '<div class="status error"><strong>âŒ éŒ¯èª¤:</strong><ul>';
                window.debugInfo.errors.forEach(err => {
                    html += `<li>${err.message || err} ${err.source ? `(${err.source}:${err.line})` : ''}</li>`;
                });
                html += '</ul></div>';
            }
            
            if (window.debugInfo.warnings.length > 0) {
                html += '<div class="status warning"><strong>âš ï¸ è­¦å‘Š:</strong><ul>';
                window.debugInfo.warnings.forEach(w => html += `<li>${w}</li>`);
                html += '</ul></div>';
            }
            
            if (window.debugInfo.success.length > 0) {
                html += '<div class="status success"><strong>âœ… æˆåŠŸ:</strong><ul>';
                window.debugInfo.success.forEach(s => html += `<li>${s}</li>`);
                html += '</ul></div>';
            }
            
            const elapsed = ((Date.now() - window.debugInfo.startTime) / 1000).toFixed(2);
            html += `<p style="margin-top: 10px; color: #666;">è¼‰å…¥æ™‚é–“: ${elapsed} ç§’</p>`;
            
            panel.innerHTML = html;
        }

        // åˆå§‹åŒ–è¨ºæ–·é¢æ¿
        window.addEventListener('DOMContentLoaded', function() {
            updateDebugPanel();
        });
    </script>

    <!-- æª¢æŸ¥ Tailwind -->
    <script>
        log('success', 'é–‹å§‹è¼‰å…¥ Tailwind CSS...');
    </script>
    <script src="https://cdn.tailwindcss.com" onload="log('success', 'Tailwind CSS è¼‰å…¥æˆåŠŸ')" onerror="log('errors', 'Tailwind CSS è¼‰å…¥å¤±æ•—')"></script>
    
    <!-- æª¢æŸ¥ SheetJS -->
    <script>
        log('success', 'é–‹å§‹è¼‰å…¥ SheetJS...');
    </script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js" onload="log('success', 'SheetJS è¼‰å…¥æˆåŠŸ')" onerror="log('errors', 'SheetJS è¼‰å…¥å¤±æ•—')"></script>

    <!-- æª¢æŸ¥ Import Maps -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <!-- æª¢æŸ¥ Babel -->
    <script>
        log('success', 'é–‹å§‹è¼‰å…¥ Babel...');
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" onload="log('success', 'Babel è¼‰å…¥æˆåŠŸ')" onerror="log('errors', 'Babel è¼‰å…¥å¤±æ•—')"></script>
</head>
<body class="bg-slate-50">
    
    <!-- Debug è¨Šæ¯é¢æ¿ -->
    <div id="debug-info">
        <h2>ğŸ”§ Debug è¨ºæ–·é¢æ¿</h2>
        <p>æ­¤é¢æ¿æœƒé¡¯ç¤ºæ‰€æœ‰è¼‰å…¥éŒ¯èª¤å’Œè­¦å‘Šï¼Œå¹«åŠ©æ‚¨æ‰¾å‡ºå•é¡Œã€‚</p>
        <div id="debug-messages">è¼‰å…¥ä¸­...</div>
        <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            é‡æ–°è¼‰å…¥
        </button>
    </div>

    <!-- æ‡‰ç”¨ç¨‹å¼å®¹å™¨ -->
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        (async function() {
            try {
                log('success', 'é–‹å§‹åŸ·è¡Œä¸»ç¨‹å¼...');
                
                // æª¢æŸ¥ React æ˜¯å¦è¼‰å…¥
                const React = await import('react');
                const { useState, useEffect, useMemo } = React;
                const { createRoot } = await import('react-dom/client');
                const Icons = await import('lucide-react');
                
                log('success', 'React å’Œç›¸é—œå¥—ä»¶è¼‰å…¥æˆåŠŸ');

                // ç°¡åŒ–ç‰ˆæ¸¬è©¦å…ƒä»¶
                const TestApp = () => {
                    const [status, setStatus] = useState('åˆå§‹åŒ–ä¸­...');
                    const [dataStatus, setDataStatus] = useState('å°šæœªæª¢æŸ¥');
                    
                    useEffect(() => {
                        setStatus('React å…ƒä»¶å·²æ›è¼‰æˆåŠŸï¼');
                        log('success', 'React å…ƒä»¶æ¸²æŸ“æˆåŠŸ');
                        
                        // æª¢æŸ¥è³‡æ–™æª”æ¡ˆ
                        fetch('./RAWData.json?t=' + Date.now())
                            .then(res => {
                                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                                return res.json();
                            })
                            .then(data => {
                                setDataStatus(`âœ… RAWData.json è®€å–æˆåŠŸ (${data.length} ç­†)`);
                                log('success', `RAWData.json è®€å–æˆåŠŸï¼Œå…± ${data.length} ç­†è³‡æ–™`);
                            })
                            .catch(err => {
                                setDataStatus(`âŒ RAWData.json è®€å–å¤±æ•—: ${err.message}`);
                                log('errors', `RAWData.json è®€å–å¤±æ•—: ${err.message}`);
                            });
                            
                        // æª¢æŸ¥æ³•æœƒè³‡æ–™æª”æ¡ˆ
                        fetch('./2026DharmaServiceDate.json?t=' + Date.now())
                            .then(res => {
                                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                                return res.json();
                            })
                            .then(data => {
                                log('success', `2026DharmaServiceDate.json è®€å–æˆåŠŸï¼Œå…± ${data.length} ç­†è³‡æ–™`);
                            })
                            .catch(err => {
                                log('warnings', `2026DharmaServiceDate.json è®€å–å¤±æ•—: ${err.message} (å°‡ä½¿ç”¨å…§å»ºè³‡æ–™)`);
                            });
                    }, []);

                    return React.createElement('div', { className: 'p-6 bg-white rounded-lg shadow' },
                        React.createElement('h1', { className: 'text-2xl font-bold mb-4 text-green-600' }, 'ğŸ‰ ç³»çµ±ç‹€æ…‹æª¢æ¸¬'),
                        React.createElement('div', { className: 'space-y-2' },
                            React.createElement('p', null, `React ç‹€æ…‹: ${status}`),
                            React.createElement('p', null, `è³‡æ–™æª”æ¡ˆ: ${dataStatus}`),
                            React.createElement('p', { className: 'text-sm text-gray-500 mt-4' }, 
                                'å¦‚æœæ‚¨çœ‹åˆ°æ­¤è¨Šæ¯ï¼Œè¡¨ç¤ºåŸºæœ¬ç³»çµ±é‹ä½œæ­£å¸¸ã€‚è«‹æŸ¥çœ‹ä¸Šæ–¹çš„ Debug é¢æ¿äº†è§£è©³ç´°ç‹€æ…‹ã€‚'
                            )
                        )
                    );
                };

                // æ›è¼‰å…ƒä»¶
                const container = document.getElementById('root');
                const root = createRoot(container);
                root.render(React.createElement(TestApp));
                
            } catch (error) {
                log('errors', 'ä¸»ç¨‹å¼åŸ·è¡Œå¤±æ•—: ' + error.message);
                console.error('ä¸»ç¨‹å¼éŒ¯èª¤:', error);
                
                // é¡¯ç¤ºéŒ¯èª¤åˆ°é é¢
                document.getElementById('root').innerHTML = `
                    <div style="background: #f8d7da; padding: 20px; border-radius: 8px; color: #721c24;">
                        <h2>âŒ ç¨‹å¼åŸ·è¡Œå¤±æ•—</h2>
                        <p><strong>éŒ¯èª¤è¨Šæ¯:</strong> ${error.message}</p>
                        <pre style="background: white; padding: 10px; border-radius: 4px; overflow: auto;">${error.stack}</pre>
                    </div>
                `;
            }
        })();
    </script>

</body>
</html>
